<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="关于CS61C第3-4个实验的个人解法"><title>CS61C FA20 Lab03-Lab04</title><link rel=canonical href=https://YuTaki23.github.io/p/cs61c-fa20-lab03-lab04/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="CS61C FA20 Lab03-Lab04"><meta property='og:description' content="关于CS61C第3-4个实验的个人解法"><meta property='og:url' content='https://YuTaki23.github.io/p/cs61c-fa20-lab03-lab04/'><meta property='og:site_name' content="YuTaki's Ideas"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='C'><meta property='article:tag' content='学习笔记'><meta property='article:published_time' content='2025-05-24T00:00:00+00:00'><meta property='article:modified_time' content='2025-05-24T00:00:00+00:00'><meta name=twitter:title content="CS61C FA20 Lab03-Lab04"><meta name=twitter:description content="关于CS61C第3-4个实验的个人解法"><link rel="shortcut icon" href=/logo.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b4750235e08b003b.png width=300 height=264 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>&lt;/></span></figure><div class=site-meta><h1 class=site-name><a href=/>YuTaki's Ideas</a></h1><h2 class=site-description>代码与歌</h2></div></header><ol class=menu-social><li><a href=https://github.com/YuTaki23 target=_blank title=GitHub rel=me><svg t="1742388666084" class="icon" viewBox="0 0 1024 1024" p-id="6728" width="200" height="200"><path d="M850.346667 155.008a42.666667 42.666667.0 00-22.741334-23.509333c-8.704-3.754667-85.717333-33.322667-200.32 39.168H396.714667c-114.773333-72.618667-191.701333-42.922667-200.32-39.168a42.88 42.88.0 00-22.741334 23.466666c-26.197333 66.218667-18.048 136.448-7.850666 176.896C134.272 374.016 128 413.098667 128 469.333333c0 177.877333 127.104 227.882667 226.730667 246.272a189.568 189.568.0 00-13.013334 46.549334A44.373333 44.373333.0 00341.333333 768v38.613333c-19.498667-4.138667-41.002667-11.946667-55.168-26.112C238.08 732.416 188.330667 682.666667 128 682.666667V768c25.002667.0 65.365333 40.362667 97.834667 72.832 51.029333 51.029333 129.066667 55.253333 153.386666 55.253333 3.114667.0 5.376-.085333 6.528-.128A42.666667 42.666667.0 00426.666667 853.333333v-82.090666c4.266667-24.746667 20.224-49.621333 27.946666-56.362667A42.666667 42.666667.0 00431.488 640.298667c-138.154667-15.744-218.154667-48.810667-218.154667-170.965334.0-53.12 5.632-70.741333 31.573334-99.285333 11.008-12.117333 14.08-29.568 7.978666-44.8C248.064 313.344 234.112 259.797333 246.4 207.701333c20.650667-1.578667 59.904 4.565333 113.706667 40.96C367.104 253.44 375.466667 256 384 256h256a42.666667 42.666667.0 0023.936-7.338667c54.016-36.522667 92.970667-41.770667 113.664-41.130666 12.330667 52.224-1.578667 105.770667-6.4 117.674666a42.666667 42.666667.0 008.021333 44.928C805.077333 398.464 810.666667 416.085333 810.666667 469.333333c0 122.581333-79.957333 155.52-218.069334 170.922667A42.666667 42.666667.0 00569.472 714.965333C589.269333 732.032 597.333333 747.434666 597.333333 768v128h85.333334V768c0-20.437333-3.925333-38.101333-9.770667-53.12C769.92 695.765333 896 643.712 896 469.333333c0-56.362667-6.272-95.530667-37.76-137.514666C868.437333 291.413334 876.501333 221.312 850.346667 155.008z" fill="#fff" p-id="6729"/></svg></a></li><li><a href=mailto:yutaki23@163.com target=_blank title=邮箱 rel=me><svg t="1742537424403" class="icon" viewBox="0 0 1024 1024" p-id="2705" width="200" height="200"><path d="M838.954667 234.666667h-668.288c-3.626667.0-7.168.448-10.56 1.322666l323.690666 323.669334a21.333333 21.333333.0 0030.165334.0l324.992-324.992zm46.144 14.186666-260.693334 260.693334 262.933334 262.912c5.44-7.168 8.661333-16.106667 8.661333-25.792V277.333333c0-10.944-4.117333-20.906667-10.88-28.48zm-41.237334 540.48-249.6-249.621333L544.128 589.845333a64 64 0 01-90.517333.0l-50.112-50.133333L156.373333 786.88c4.48 1.578667 9.28 2.453333 14.314667 2.453333h673.194667zM128.661333 754.218667l244.672-244.693334-243.754666-243.712A42.709333 42.709333.0 00128 277.333333v469.333334c0 2.56.213333 5.098667.661333 7.552zM170.666667 192h682.666666a85.333333 85.333333.0 0185.333334 85.333333v469.333334A85.333333 85.333333.0 01853.333333 832H170.666667a85.333333 85.333333.0 01-85.333334-85.333333V277.333333A85.333333 85.333333.0 01170.666667 192z" fill="#fff" p-id="2706"/></svg></a></li><li><a href=https://www.zhihu.com/people/yutaki-61 target=_blank title=知乎 rel=me><svg t="1742384826142" class="icon" viewBox="0 0 1024 1024" p-id="2995" width="200" height="200"><path d="M544.949 561.422s0-71.387-34.779-75.05-142.775.0-142.775.0V266.718h161.078s-1.83-73.219-32.949-73.219H233.769l43.93-117.148s-65.897 3.663-89.692 45.761-98.844 252.604-98.844 252.604 25.627 10.983 67.726-20.134c42.101-31.116 56.743-86.033 56.743-86.033l76.879-3.663 1.83 223.316s-133.621-1.83-161.078.0-42.101 75.05-42.101 75.05h203.182s-18.307 124.47-69.557 214.164c-53.085 89.692-151.929 161.078-151.929 161.078s71.387 29.287 140.947-10.983c69.557-42.101 120.811-223.316 120.811-223.316l162.912 203.182s14.643-97.013-1.83-124.47c-18.307-27.457-113.49-137.283-113.49-137.283l-42.101 36.607 29.287-120.811h177.552zM587.05 188.01l-1.83 660.793h65.897l23.795 82.37 115.321-82.37h162.912V188.01H587.054zM879.92 775.584h-76.879l-97.013 75.05-21.965-75.05h-20.134V263.057H879.92v512.527z" fill="#fff" p-id="2996"/></svg></a></li><li><a href=https://space.bilibili.com/45550397 target=_blank title=哔哩哔哩 rel=me><svg t="1742384990540" class="icon" viewBox="0 0 1024 1024" p-id="5704" width="200" height="200"><path d="M278.8864 148.1728c14.336-8.192 32.6144-9.3696 47.8208-2.6624 11.3664 4.6592 19.968 13.824 29.184 21.6064 38.144 32.9216 75.9808 66.304 114.2784 99.0208h80.4352c38.2976-32.768 76.0832-66.048 114.2272-98.9696 9.2672-7.7824 17.8688-16.896 29.2864-21.6576 14.7456-6.5024 32.4608-5.632 46.592 2.048 16.5888 8.5504 28.1088 26.2656 28.8256 44.9536 1.024 13.568-3.84 27.2896-12.3392 37.7856-7.5264 8.3456-16.5376 15.2064-24.8832 22.6816-5.3248 4.4032-10.1376 9.5232-16.0256 13.2096 23.6544.0 47.2576-.256 70.912.1536 31.1296.8192 61.44 14.592 82.8928 37.1712 22.6304 22.2208 35.5328 53.5552 35.4816 85.1968.1024 108.4416.0 216.9344.0512 325.376-.1024 16.384.8192 33.024-2.816 49.152-6.656 32.9728-28.8256 61.5936-56.9856 79.36a121.344 121.344.0 01-64.7168 17.7664H263.2704c-16.9984-.1024-34.2528.8704-50.9952-2.8672-32.1024-6.4512-60.0064-27.648-77.824-54.6304A121.088 121.088.0 01115.2 735.8976v-321.536c.1024-16.5376-.9216-33.1776 2.4576-49.408 10.24-52.9408 58.9312-96.1024 112.9984-98.4576 24.6272-.768 49.3056-.2048 73.9328-.3072-11.6224-8.3968-21.8112-18.5344-32.768-27.7504a55.04 55.04.0 01-20.5312-45.9264c.7168-18.2272 11.6736-35.584 27.648-44.3392m-13.056 221.7984c-20.992 3.7376-38.912 20.3264-44.7488 40.7552a76.4928 76.4928.0 00-2.3552 21.7088c.1024 89.0368-.0512 178.0736.0512 267.1616-.4096 24.2176 16.3328 47.1552 39.1168 54.8864 8.1408 2.9696 16.896 3.0208 25.3952 3.072 153.1904-.1024 306.432.0512 459.6224-.0512 22.4768.8704 44.0832-13.1072 53.5552-33.28 5.7856-11.5712 5.6832-24.7296 5.4784-37.376V438.016c0-9.1136.3072-18.4832-2.304-27.2896a58.7776 58.7776.0 00-36.864-38.656c-9.7792-3.584-20.4288-3.0208-30.6688-3.072H292.5056c-8.8576.0-17.8176-.3072-26.624.9728z" fill="#fff" p-id="5705"/><path d="M358.7072 455.5264c14.6432-1.4848 29.8496 3.2768 41.0112 12.8 12.4416 10.24 19.5584 26.112 19.7632 42.1376.3584 19.4048.1024 38.8608.1024 58.2656.0 12.8-3.3792 25.8048-11.3152 35.9424a54.9888 54.9888.0 01-48.4864 21.76 54.9376 54.9376.0 01-44.032-28.2624c-6.8096-11.6736-7.3728-25.4976-7.168-38.6048.4096-18.8416-1.024-37.7856.8704-56.576a55.296 55.296.0 0149.2544-47.4624zm292.4544.0a55.2448 55.2448.0 0160.7232 53.0432c.8192 18.2272.1024 36.4544.4096 54.6816.1024 12.8-1.4336 26.112-8.4992 37.12-10.24 17.0496-30.3104 27.5456-50.176 26.112a55.04 55.04.0 01-43.3664-24.9856c-7.936-11.776-9.472-26.2656-9.1136-40.0896.3584-18.7392-.6656-37.4784.6144-56.1664 1.8432-25.6 23.9104-47.5136 49.408-49.664z" fill="#fff" p-id="5706"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/gallery/><svg t="1747214407998" class="icon" viewBox="0 0 1024 1024" p-id="3012" width="200" height="200"><path d="M970.98512 120.33229H53.517952c-21.157046.0-38.509848 15.792642-38.509848 35.572926v712.463392c0 19.300137 17.351529 35.318206 38.509848 35.318206H970.98512c20.656521.0 38.009323-16.018069 38.009323-35.318206V155.905216c0-19.785378-17.352802-35.572926-38.009323-35.572926zm-38.484376 712.995757H91.496709v-77.893386L288.72643 573.620597l135.909693 125.230556v.231795l.550196.50944.276371.25472.525997.485242.275097.25472.550196.485242 80.299216 74.403721a25.078461 25.078461.0 0032.550673.0c8.6885-8.533121 8.6885-22.04984.0-30.048049l-65.651541-60.113927 185.563543-171.52847 272.921052 251.918112v67.628168zm0-127.473367L675.824462 468.937031a24.409821 24.409821.0 00-32.525201.0L441.991473 655.258367 304.730489 529.033129a23.252118 23.252118.0 00-31.999204.0L91.496709 695.338564V190.968702h841.004035V705.85468zM303.3792 474.950971c72.962006.0 133.205841-55.5901 133.20584-123.220815.0-67.354344-60.241288-122.711375-133.20584-122.711375-73.232009.0-133.205841 55.357031-133.205841 122.711375.0 67.628168 59.967463 123.220815 133.205841 123.220815zm0-203.357011c48.023641.0 87.635153 36.081093 87.635153 80.136196.0 44.586194-39.608965 81.12833-87.635153 81.12833-47.999443.0-87.610955-36.543409-87.610955-81.12833.0-44.055103 39.608965-80.136196 87.610955-80.136196z" fill="#fff" p-id="3013"/></svg>
<span>Gallery</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://YuTaki23.github.io/ selected>中文</option><option value=https://YuTaki23.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#exercise-1>Exercise 1</a></li><li><a href=#exercise-2>Exercise 2</a></li><li><a href=#exercise-3>Exercise 3</a></li><li><a href=#exercise-4>Exercise 4</a></li><li><a href=#exercise-5>Exercise 5</a></li></ol><ol><li><a href=#exercise-1-1>Exercise 1</a></li><li><a href=#exercise-2-1>Exercise 2</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/cs61c/>CS61C
</a><a href=/categories/%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/>解题思路</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/cs61c-fa20-lab03-lab04/>CS61C FA20 Lab03-Lab04</a></h2><h3 class=article-subtitle>关于CS61C第3-4个实验的个人解法</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 24, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 4 分钟</time></div></footer></div></header><section class=article-content><h1 id=lab-03>Lab 03</h1><h2 id=exercise-1>Exercise 1</h2><p>本题让我们熟悉了 venus 的用法，这是一个可以模拟 riscv 代码的一个编辑器。</p><ol><li><code>.data</code> 表示数据段的开始，用于定义已初始化的全局或静态变量。<code>.word</code> 初始化一个变量。<code>.text</code> 表示代码段的开始。</li><li>34 这是第九个斐波那契数</li><li>t3</li></ol><h2 id=exercise-2>Exercise 2</h2><ol><li><code>t0</code></li><li><code>s0</code></li><li><code>s2</code></li><li><code>loop</code> 下面部分的代码</li><li>使用 <code>sp</code> 寄存器</li></ol><h2 id=exercise-3>Exercise 3</h2><p>本题需要我们使用 riscv 语法完成阶乘函数，题目在 <code>main</code> 函数中已经告诉我们将 <code>a0</code> 作为参数 <code>n </code>传递给函数，我们只需要完成函数内部实现即可。</p><p>需要注意的是，根据<strong>Calling Convention</strong>，<code>factorial</code> 作为 callee，是要在其函数内部分配栈空间的，这样才能将通过函数调用后的参数返回给 <code>main</code> 函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>factorial:</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=p>-</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>t0</span><span class=p>,</span> <span class=no>x0</span><span class=p>,</span> <span class=mi>1</span> <span class=c1># int i = 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>s0</span><span class=p>,</span> <span class=no>x0</span><span class=p>,</span> <span class=mi>1</span> <span class=c1># int res = 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nl>loop:</span>
</span></span><span class=line><span class=cl>        <span class=nf>blt</span> <span class=no>a0</span><span class=p>,</span> <span class=no>t0</span><span class=p>,</span> <span class=no>exit</span> <span class=c1># 若 i &gt; n 则跳转到结尾
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mul</span> <span class=no>s0</span><span class=p>,</span> <span class=no>s0</span><span class=p>,</span> <span class=no>t0</span>
</span></span><span class=line><span class=cl>        <span class=nf>addi</span> <span class=no>t0</span><span class=p>,</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nf>j</span> <span class=no>loop</span>
</span></span><span class=line><span class=cl>    <span class=nl>exit:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mv</span> <span class=no>a0</span><span class=p>,</span> <span class=no>s0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>lw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise-4>Exercise 4</h2><p>本题需要我们修改若干个关于<strong>Calling Convention</strong>的问题，其中大部分都是关于<strong>栈内存</strong>的问题，总体来说并不难，只需要注意哪个寄存器是要在被调用后还需要保存的，就将这个寄存器分配一块属于它的栈空间即可。</p><p>需要注意的是，其中 <code>inc_arr</code> 函数中还调用了一个函数，在这里还需要分配一块空间。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>simple_fn:</span>
</span></span><span class=line><span class=cl>    <span class=nf>mv</span> <span class=no>a0</span><span class=p>,</span> <span class=no>x0</span>
</span></span><span class=line><span class=cl>    <span class=nf>li</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nf>ret</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nl>naive_pow:</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=p>-</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># END PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>li</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nl>naive_pow_loop:</span>
</span></span><span class=line><span class=cl>    <span class=nf>beq</span> <span class=no>a1</span><span class=p>,</span> <span class=no>zero</span><span class=p>,</span> <span class=no>naive_pow_end</span>
</span></span><span class=line><span class=cl>    <span class=nf>mul</span> <span class=no>s0</span><span class=p>,</span> <span class=no>s0</span><span class=p>,</span> <span class=no>a0</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>a1</span><span class=p>,</span> <span class=no>a1</span><span class=p>,</span> <span class=p>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nf>j</span> <span class=no>naive_pow_loop</span>
</span></span><span class=line><span class=cl><span class=nl>naive_pow_end:</span>
</span></span><span class=line><span class=cl>    <span class=nf>mv</span> <span class=no>a0</span><span class=p>,</span> <span class=no>s0</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=c1># END EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>ret</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nl>inc_arr:</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># FIXME What other registers need to be saved?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=p>-</span><span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>ra</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>4</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s1</span><span class=p>,</span> <span class=mi>8</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># END PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>mv</span> <span class=no>s0</span><span class=p>,</span> <span class=no>a0</span> <span class=c1># Copy start of array to saved register
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>mv</span> <span class=no>s1</span><span class=p>,</span> <span class=no>a1</span> <span class=c1># Copy length of array to saved register
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>li</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>0</span> <span class=c1># Initialize counter to 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>inc_arr_loop:</span>
</span></span><span class=line><span class=cl>    <span class=nf>beq</span> <span class=no>t0</span><span class=p>,</span> <span class=no>s1</span><span class=p>,</span> <span class=no>inc_arr_end</span>
</span></span><span class=line><span class=cl>    <span class=nf>slli</span> <span class=no>t1</span><span class=p>,</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>2</span> <span class=c1># Convert array index to byte offset
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>add</span> <span class=no>a0</span><span class=p>,</span> <span class=no>s0</span><span class=p>,</span> <span class=no>t1</span> <span class=c1># Add offset to start of array
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># Prepare to call helper_fn
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># FIXME Add code to preserve the value in t0 before we call helper_fn
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># Hint: What does the &#34;t&#34; in &#34;t0&#34; stand for?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># Also ask yourself this: why don&#39;t we need to preserve t1?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>sw</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>12</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>jal</span> <span class=no>helper_fn</span>
</span></span><span class=line><span class=cl>    <span class=nf>lw</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>12</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Finished call for helper_fn
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>t0</span><span class=p>,</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>1</span> <span class=c1># Increment counter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>j</span> <span class=no>inc_arr_loop</span>
</span></span><span class=line><span class=cl><span class=nl>inc_arr_end:</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>ra</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>lw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>4</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>lw</span> <span class=no>s1</span><span class=p>,</span> <span class=mi>8</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=c1># END EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>ret</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nl>helper_fn:</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=p>-</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># END PROLOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>t1</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>a0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>s0</span><span class=p>,</span> <span class=no>t1</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>a0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># BEGIN EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=c1># END EPILOGUE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>ret</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise-5>Exercise 5</h2><p>本题需要我们完成一个 <code>map</code> 函数，其中参数 1 给定一个列表，参数 2 给定一个函数。先打印原列表，再打印经过函数处理后的列表。</p><p>题目要求在注释里面都给定了，讲的也很清楚。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=c1># load the address of the function in question into a1 (check out la on the green sheet)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>la</span> <span class=no>a1</span><span class=p>,</span> <span class=no>square</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>map:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Prologue: Make space on the stack and back-up registers
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span> <span class=p>-</span><span class=mi>12</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>ra</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>4</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sw</span> <span class=no>s1</span><span class=p>,</span> <span class=mi>8</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>beq</span> <span class=no>a0</span><span class=p>,</span> <span class=no>x0</span><span class=p>,</span> <span class=no>done</span>    <span class=c1># If we were given a null pointer (address 0), we&#39;re done.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nf>add</span> <span class=no>s0</span><span class=p>,</span> <span class=no>a0</span><span class=p>,</span> <span class=no>x0</span>  <span class=c1># Save address of this node in s0
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>add</span> <span class=no>s1</span><span class=p>,</span> <span class=no>a1</span><span class=p>,</span> <span class=no>x0</span>  <span class=c1># Save address of function in s1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1># Remember that each node is 8 bytes long: 4 for the value followed by 4 for the pointer to next.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># What does this tell you about how you access the value and how you access the pointer to next?
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1># load the value of the current node into a0
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># THINK: why a0?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>s0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Call the function in question on that value. DO NOT use a label (be prepared to answer why).
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># What function? Recall the parameters of &#34;map&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>jalr</span> <span class=no>s1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># store the returned value back into the node
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># Where can you assume the returned value is?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>sw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>s0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Load the address of the next node into a0
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># The Address of the next node is an attribute of the current node.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># Think about how structs are organized in memory.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>4</span><span class=p>(</span><span class=no>s0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Put the address of the function back into a1 to prepare for the recursion
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1># THINK: why a1? What about a0?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>mv</span> <span class=no>a1</span><span class=p>,</span> <span class=no>s1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># recurse
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>jal</span> <span class=no>ra</span><span class=p>,</span> <span class=no>map</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>done:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Epilogue: Restore register values and free space from the stack
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>lw</span> <span class=no>s1</span><span class=p>,</span> <span class=mi>8</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>lw</span> <span class=no>s0</span><span class=p>,</span> <span class=mi>4</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>lw</span> <span class=no>ra</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>12</span>	
</span></span><span class=line><span class=cl>    <span class=no>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span><span class=p>,</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>jr</span> <span class=no>ra</span> <span class=c1># Return to caller
</span></span></span></code></pre></td></tr></table></div></div><h1 id=lab-04>Lab 04</h1><h2 id=exercise-1-1>Exercise 1</h2><p>本题需要我们找出代码中的错误，具体错误如下</p><ol><li>在加载字的时候应使用 <code>lw</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>	<span class=nf>lw</span> <span class=no>t1</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>s0</span><span class=p>)</span> <span class=c1># add t1, s0, x0      # load the address of the array of 	current node into t1
</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li>对于一个数组来说，每到下一个数组内容，需要增加 4 字节，故要注意偏移量的问题</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>	<span class=nf>addi</span> <span class=no>t3</span><span class=p>,</span> <span class=no>x0</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=nf>mul</span> <span class=no>t3</span><span class=p>,</span> <span class=no>t3</span><span class=p>,</span> <span class=no>t0</span>
</span></span><span class=line><span class=cl>    <span class=nf>add</span> <span class=no>t1</span><span class=p>,</span> <span class=no>t1</span><span class=p>,</span> <span class=no>t3</span>      <span class=c1># offset the array address by the count
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>t1</span><span class=p>)</span>        <span class=c1># load the value at that address into a0
</span></span></span></code></pre></td></tr></table></div></div><ol start=3><li>每当我们调用一个函数时，要先对这个返回值分配内存，随后再释放内存</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span> <span class=p>-</span><span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=nf>sw</span> <span class=no>t1</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>jalr</span> <span class=no>s1</span>             <span class=c1># call the function on that value.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>lw</span> <span class=no>t1</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>sp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>addi</span> <span class=no>sp</span><span class=p>,</span> <span class=no>sp</span> <span class=mi>4</span>
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>加载数组的值到寄存器中应使用 <code>lw</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>    <span class=nf>lw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>8</span><span class=p>(</span><span class=no>s0</span><span class=p>)</span>        <span class=c1># load the address of the next node into a0
</span></span></span></code></pre></td></tr></table></div></div><ol start=5><li>递归调用函数时</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>    <span class=nf>mv</span> <span class=no>a1</span><span class=p>,</span> <span class=no>s1</span> <span class=c1># lw a1, 0(s1)        # put the address of the function back into a1 to prepare for the recursion
</span></span></span></code></pre></td></tr></table></div></div><h2 id=exercise-2-1>Exercise 2</h2><p>本题向我们介绍了<strong>如何使用动态地址加载一个字</strong></p><p>动态索引通常需要我们将索引转换为字节偏移量，也就是乘 4</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>f:</span>
</span></span><span class=line><span class=cl>    <span class=nf>addi</span> <span class=no>t0</span><span class=p>,</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>3</span> <span class=c1># 从-3到3，+3后变为0到6 求index
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>slli</span> <span class=no>t0</span><span class=p>,</span> <span class=no>t0</span><span class=p>,</span> <span class=mi>2</span> <span class=c1># 索引转换为字节偏移量 t0 = index * 4 slli左移两位代表 *4
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>add</span> <span class=no>a1</span><span class=p>,</span> <span class=no>a1</span><span class=p>,</span> <span class=no>t0</span> <span class=c1># 计算元素地址，a1 = arr + (index * 4)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>lw</span> <span class=no>a0</span><span class=p>,</span> <span class=mi>0</span><span class=p>(</span><span class=no>t0</span><span class=p>)</span> <span class=c1># 加载 arr[index] 到 a0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nf>jr</span> <span class=no>ra</span>               <span class=c1># Always remember to jr ra after your function!
</span></span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/c/>C</a>
<a href=/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/cs61c-fa20-project1/><div class=article-details><h2 class=article-title>CS61C FA20 Project1</h2></div></a></article><article><a href=/p/cs61c-fa20-lab01-lab02/><div class=article-details><h2 class=article-title>CS61C FA20 Lab01-Lab02</h2></div></a></article><article><a href=/p/cs144-winter2025-check0/><div class=article-details><h2 class=article-title>CS144 Winter2025 Check0</h2></div></a></article><article><a href=/p/cs106l-winter2025-assignment7-unique-pointer/><div class=article-details><h2 class=article-title>CS106L Winter2025 Assignment7 Unique Pointer</h2></div></a></article><article><a href=/p/cs106l-winter2025-assignment6-explore-courses/><div class=article-details><h2 class=article-title>CS106L Winter2025 Assignment6 Explore Courses</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=YuTaki23/YuTaki23.github.io data-repo-id=R_kgDOOLOVVw data-category=Announcements data-category-id=DIC_kwDOOLOVV84CpOPn data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 YuTaki. All rights reserved.</section><section class=powerby>不会摄影的药师不是好程序员<br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>